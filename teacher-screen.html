<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>集計表示（投影用）</title>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f7f7f7;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .graph-container {
            width: 90%;
            margin: 0 auto;
            margin-top: 30px;
        }
        .bar {
            height: 60px;
            background: #ddd;
            margin: 20px 0;
            border-radius: 40px;
            position: relative;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            width: 0%;
            border-radius: 40px;
            transition: width 0.4s;
        }
        .bar-label {
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            font-size: 28px;
            font-weight: bold;
        }
        .bar-count {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            font-size: 28px;
            font-weight: bold;
        }

        #qr {
            margin-top: 40px;
        }
    </style>
</head>
<body>

<h1 style="font-size: 40px; margin-bottom: 10px;">集計結果</h1>

<div class="graph-container">
    <div class="bar">
        <div class="bar-fill" id="barO" style="background:#4CAF50;"></div>
        <div class="bar-label">○</div>
        <div class="bar-count" id="countO">0</div>
    </div>

    <div class="bar">
        <div class="bar-fill" id="barX" style="background:#F44336;"></div>
        <div class="bar-label">×</div>
        <div class="bar-count" id="countX">0</div>
    </div>
</div>

<h2 style="font-size: 34px; margin-top: 40px;">参加用QRコード</h2>
<div id="qr"></div>

<!-- QRコード生成用 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    // ★ 必ず index.html と同じ設定を記入
const firebaseConfig = {
  apiKey: "AIzaSyBke-wTU16skpbK8z80ddK04tE154dHERQ",
  authDomain: "satosan-41eac.firebaseapp.com",
  databaseURL: "https://satosan-41eac-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "satosan-41eac",
  storageBucket: "satosan-41eac.firebasestorage.app",
  messagingSenderId: "992482993229",
  appId: "1:992482993229:web:e2c59b078233b0ed16e804",
  measurementId: "G-VT9FKHN3LT"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // URL パラメータから room を取得
    const params = new URLSearchParams(window.location.search);
    const room = params.get("room") || "kyoto-01";

    // QRコード生成
    const joinURL = `${location.origin}/student.html?room=${room}`;
    new QRCode(document.getElementById("qr"), {
        text: joinURL,
        width: 300,
        height: 300
    });

    // 集計のリアルタイム反映
    const resultRef = ref(db, `rooms/${room}/result`);

    onValue(resultRef, snapshot => {
        const data = snapshot.val();
        if (!data) return;

        const O = data.O || 0;
        const X = data.X || 0;
        const total = O + X;

        document.getElementById("countO").innerText = O;
        document.getElementById("countX").innerText = X;

        document.getElementById("barO").style.width = total === 0 ? "0%" : `${(O / total) * 100}%`;
        document.getElementById("barX").style.width = total === 0 ? "0%" : `${(X / total) * 100}%`;
    });
</script>

</body>
</html>
