<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ•™å“¡ç”¨ã‚¯ã‚¤ã‚ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
import { db, ref, set, onValue, update } from "./common.js";

const activityRef = ref(db, "activity");
const resultRef = ref(db, "result");

// åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åˆæœŸå€¤ã‚’è¨­å®šï¼‰
set(activityRef, { status: "locked" });
set(resultRef, { O: 0, X: 0 });

document.addEventListener("DOMContentLoaded", () => {
  const lockBtn = document.getElementById("lock");
  const unlockBtn = document.getElementById("unlock");
  const resetBtn = document.getElementById("reset");
  const ctx = document.getElementById("resultChart").getContext("2d");

  // Chart.jsè¨­å®š
  const chart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["â—‹", "Ã—"],
      datasets: [{
        data: [0, 0],
        backgroundColor: ["#4dd0e1", "#ef9a9a"],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" },
        title: { display: true, text: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é›†è¨ˆçµæœ" }
      }
    }
  });

  // ãƒœã‚¿ãƒ³æ“ä½œ
  lockBtn.onclick = () => update(activityRef, { status: "locked" });
  unlockBtn.onclick = () => update(activityRef, { status: "open" });
  resetBtn.onclick = () => set(resultRef, { O: 0, X: 0 });

  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
  onValue(resultRef, (snapshot) => {
    const data = snapshot.val() || { O: 0, X: 0 };
    chart.data.datasets[0].data = [data.O, data.X];
    chart.update();
  });
});
</script>
</head>

<body>
<h1>æ•™å“¡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«</h1>

<div class="controls">
  <button id="unlock">ğŸŸ¢ å›ç­”é–‹å§‹</button>
  <button id="lock">ğŸ”´ å›ç­”çµ‚äº†</button>
  <button id="reset">ğŸ§¹ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<canvas id="resultChart" width="300" height="300"></canvas>

</body>
</html>

