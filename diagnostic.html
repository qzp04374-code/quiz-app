<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebaseæ¥ç¶šè¨ºæ–­</title>
<style>
body {
  background: #121212;
  color: #fff;
  font-family: monospace;
  padding: 2rem;
}
pre {
  background: #1f1f1f;
  padding: 1rem;
  border-radius: 10px;
  overflow-x: auto;
}
button {
  padding: 0.8rem 1.5rem;
  margin-top: 1rem;
  border: none;
  border-radius: 6px;
  background: #00bcd4;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background: #0097a7;
}
</style>

<script type="module">
import { db, ref, set, get } from "./common.js";

async function testFirebase() {
  const output = document.getElementById("output");
  output.textContent = "=== Firebase é€šä¿¡ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ ===\n";

  try {
    // æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆ
    const testRef = ref(db, "diagnostic/test");
    const value = { time: new Date().toLocaleString(), status: "ok" };
    await set(testRef, value);
    output.textContent += "âœ… æ›¸ãè¾¼ã¿æˆåŠŸ\n";

    // èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
    const snap = await get(testRef);
    const data = snap.val();
    output.textContent += "âœ… èª­ã¿è¾¼ã¿æˆåŠŸ\n";
    output.textContent += "å—ä¿¡ãƒ‡ãƒ¼ã‚¿: " + JSON.stringify(data, null, 2) + "\n";

    output.textContent += "\nğŸ‰ Firebase é€šä¿¡ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼";

  } catch (e) {
    output.textContent += "\nâŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:\n" + e.message + "\n\n";
    output.textContent += "ğŸ’¡ å¯¾ç­–: \n";
    output.textContent += "1. common.js ã® Firebase è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª\n";
    output.textContent += "2. Realtime Database ã®ãƒ«ãƒ¼ãƒ«ã‚’ä»¥ä¸‹ã«ã—ã¦ä¿å­˜\n";
    output.textContent += `{
  "rules": {
    ".read": true,
    ".write": true
  }
}\n`;
  }
}
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("testBtn").addEventListener("click", testFirebase);
});
</script>
</head>

<body>
<h1>Firebase æ¥ç¶šè¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
<p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€Firebase ã¨ã®é€šä¿¡ãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p>
<button id="testBtn">é€šä¿¡ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
<pre id="output">æº–å‚™ä¸­...</pre>
</body>
</html>

